{% extends 'base.html' %}
{% block title %}利用履歴一覧{% endblock %}

{% block content %}
<h1 class="mb-4">利用履歴一覧</h1>

<div class="d-flex justify-content-between align-items-center mb-3">
    <p class="mb-0"><strong>総件数: {{ total_count }}件</strong></p>
    <div>
        <a href="{% url 'records:monthly_report' %}" class="btn btn-warning">月次レポート</a>
        <a href="{% url 'records:summary' %}" class="btn btn-info">レポート・照合</a>
        <a href="{% url 'records:import_csv' %}" class="btn btn-primary">CSVインポート</a>
        <a href="{% url 'records:delete_all' %}" class="btn btn-danger">全件削除</a>
        <a href="{% url 'records:export_csv' %}" class="btn btn-success">経理用CSVエクスポート</a>
    </div>
</div>

<div class="table-responsive">
    <table class="table table-striped table-bordered">
        <thead class="table-light">
            <tr>
                <th>操作日時</th>
                <th>店舗名称</th>
                <th>カード会社</th>
                <th>伝票番号</th>
                <th>支払金額</th>
                <th>支払い区分</th>
                <th>操作</th>
            </tr>
        </thead>
        <tbody>
            {% for record in object_list %}
            <tr>
                <td>{{ record.transaction_datetime|date:"Y/m/d H:i" }}</td>
                <td>{{ record.store_name }}</td>
                <td>{{ record.card.name }}</td>
                <td>{{ record.slip_number }}</td>
                <td class="text-end">¥{{ record.payment_amount }}</td>
                <td>
                    {% if record.installments %}
                        {{ record.payment_type }} ({{ record.installments }}回)
                    {% else %}
                        {{ record.payment_type|default:"<span class='text-muted'>未選択</span>"|safe }}
                    {% endif %}
                </td>
                <td>
                    {% if record.card.name == 'クレジット' %}
                        <a href="{% url 'records:record_edit' record.pk %}" class="btn btn-sm btn-outline-primary">編集</a>
                    {% endif %}
                </td>
            </tr>
            {% empty %}
            <tr>
                <td colspan="7" class="text-center">データがありません。</td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>
{% endblock %}