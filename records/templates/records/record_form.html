{% extends 'base.html' %}
{% block title %}利用区分の編集{% endblock %}

{% block content %}
<div class="row justify-content-center">
    <div class="col-md-6">
        <div class="card">
            <div class="card-header">
                <h1 class="h3 mb-0">利用区分の編集</h1>
            </div>
            <div class="card-body">
                <p><strong>取引情報:</strong> {{ object }}</p>
                <form method="post">
                    {% csrf_token %}
                    
                    <div class="mb-3">
                        <label for="{{ form.payment_type.id_for_label }}" class="form-label">{{ form.payment_type.label }}</label>
                        {{ form.payment_type }}
                    </div>
                    
                    <div id="installments-row" class="mb-3" style="display: none;">
                        <label for="{{ form.installments.id_for_label }}" class="form-label">{{ form.installments.label }}</label>
                        {{ form.installments }}
                    </div>

                    <button type="submit" class="btn btn-primary">保存</button>
                    <a href="{% url 'records:record_list' %}" class="btn btn-secondary ms-2">一覧に戻る</a>
                </form>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
    // フォーム要素を取得
    const paymentTypeSelect = document.getElementById('payment_type_select'); // forms.pyで指定したID
    const installmentsRow = document.getElementById('installments-row');
    const installmentsInput = document.getElementById('installments_input'); // forms.pyで指定したID

    // Bootstrapのクラスを適用
    paymentTypeSelect.classList.add('form-select');
    installmentsInput.classList.add('form-control');

    // 分割回数フィールドの表示/非表示を切り替える関数
    function toggleInstallmentsField() {
        const selectedValue = paymentTypeSelect.value;
        if (selectedValue && selectedValue.includes('分割')) {
            installmentsRow.style.display = 'block';
        } else {
            installmentsRow.style.display = 'none';
            installmentsInput.value = ''; // 非表示にするときは値をクリア
        }
    }

    // ページ読み込み時と選択変更時に実行
    document.addEventListener('DOMContentLoaded', toggleInstallmentsField);
    paymentTypeSelect.addEventListener('change', toggleInstallmentsField);
</script>
{% endblock %}